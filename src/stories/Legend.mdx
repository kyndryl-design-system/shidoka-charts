import { Meta, Canvas, Stories } from '@storybook/blocks';
import * as LegendStories from './Legend.stories.js';

<Meta title="Guidelines/Legend" of={LegendStories} />

# Legend

Legends help users identify the data series displayed in a chart. The Shidoka Charts library offers several example options for legends:

## Legend Types

1. **Canvas Legend** - The native Chart.js canvas-based legend
2. **Built-in HTML Legend** - An enhanced HTML legend with better styling and scrollability
3. **External HTML Legends** - Custom legends rendered outside the chart component

## Built-in Legend Usage

The chart component has a `useHtmlLegend` attribute that controls which legend to use.

### Canvas Legend

This uses the default Chart.js canvas-rendered legend:

```html
<kd-chart
  type="bar"
  useHtmlLegend="false"
  .options=${{
    plugins: {
      legend: {
        position: 'bottom'
      }
    }
  }}
></kd-chart>
```

### HTML Legend

> ⚠️ **Warning:** Implementing the HTML legend should be done with caution. Depending on your implementation approach, it may lead to breakages or inconsistencies in your chart's appearance or behavior. Always test thoroughly across different browsers and with various data configurations to ensure reliability.

This uses an enhanced HTML-based legend with better styling and scrollability:

```html
<kd-chart
  type="bar"
  useHtmlLegend
  htmlLegendMaxHeight="200"
  .options=${{
    plugins: {
      legend: { position: 'bottom' },
      customLegend: {
        boxWidth: 16,
        boxHeight: 16,
        borderRadius: 2
      }
    }
  }}
></kd-chart>
```

The HTML legend can be configured using the `plugins.htmlLegend` options in the chart configuration:

| Option           | Description                            | Default          |
| ---------------- | -------------------------------------- | ---------------- |
| `maxHeight`      | Maximum height before scrolling begins | 100px            |
| `containerClass` | CSS class for the legend container     | 'shidoka-legend' |
| `layout`         | Legend layout orientation              | 'horizontal'     |

## External Custom Legends

For more customized legends, you can create external legends using provided helper functions.

### Standard HTML Legend

```javascript
import { renderHTMLLegend } from 'shidoka-charts/common/legend';

const chart = document.querySelector('kd-chart').chart;
const container = document.getElementById('legend-container');

renderHTMLLegend(chart, container, {
  maxHeight: 100, // Max height before scrolling begins
  boxWidth: 16, // Width of color box
  boxHeight: 16, // Height of color box
  borderRadius: 2, // Border radius of color box
  className: 'shidoka-legend', // CSS class for legend
  itemClassName: 'shidoka-legend-item', // CSS class for legend items
  layout: 'horizontal', // Legend layout orientation ('horizontal' or 'vertical')
});
```

### Custom Styled Legend

```javascript
import { renderCustomLegend } from 'shidoka-charts/common/legend';

const chart = document.querySelector('kd-chart').chart;
const container = document.getElementById('legend-container');

renderCustomLegend(chart, container, {
  maxHeight: 100,
  boxWidth: 16,
  boxHeight: 16,
  className: 'custom-legend',
  itemClassName: 'custom-legend-item',
});
```

### Boxed Legend Style

```javascript
import { renderBoxedLegend } from 'shidoka-charts/common/legend';

const chart = document.querySelector('kd-chart').chart;
const container = document.getElementById('legend-container');

renderBoxedLegend(chart, container, {
  maxHeight: 100,
});
```

## Handling Large Legends

For charts with many data points, legends can become large. The HTML legend automatically adds scrolling when items exceed the container size. This behavior is demonstrated in the HTMLLegendOverflow and DoughnutLegendOverflow examples below.

### Customizing Scrollable Legends

You can customize the scrollable behavior by setting the `maxHeight` option and adding custom styles:

```html
<kd-chart
  type="pie"
  useHtmlLegend
  .options=${{
    plugins: {
      htmlLegend: {
        containerClass: 'overflow-legend-container',
        maxHeight: 200, // Controls scrolling threshold
      }
    }
  }}
></kd-chart>

<style>
  /* Custom CSS to enhance scrollable legends */
  .overflow-legend-container .shidoka-legend-scroll-content {
    max-height: 100px;
    overflow-y: auto;
    border: 1px solid #eee;
    border-radius: 4px;
    padding: 8px;
  }
</style>
```

The HTML legend renders with the following structural elements that you can target for styling:

```
div.shidoka-legend (or your custom className)
  └── div.shidoka-legend-scroll-content
       └── ul.shidoka-legend-items
            └── li.shidoka-legend-item
                 ├── span.shidoka-legend-item-color
                 └── span.shidoka-legend-item-label
```

<style>
  {`
    .sbdocs-content {
      max-width: none !important;
    }
  `}
</style>

<Stories />
